---
layout: post
title: Should & Substitute–two new great friends
date: '2010-11-05T09:33:00.001+01:00'
author: Marcus Hammarberg
tags:
- BDD
- Tools
- .NET
- TDD
modified_time: '2010-12-14T16:22:38.152+01:00'
blogger_id: tag:blogger.com,1999:blog-36533086.post-1188276247401983374
blogger_orig_url: http://www.marcusoft.net/2010/11/should-substitutetwo-new-great-friends.html
---

<p>Recently I’ve stumbled upon two great framework that greatly enhanced my test code. </p> <h3>Should I? Yes – you should!</h3> <p>First up is <a href="http://should.codeplex.com/" target="_blank">Should</a> – which is a assertion framework that makes your assertions much more readable and easier to write. Here’s some code that shows off it’s capabilities:</p><pre>    object obj = null;<br />    obj.Should().Be.Null();<br /><br />    obj = new object();<br />    obj.Should().Be.OfType(typeof(object));<br />    obj.Should().Equal(obj);<br />    obj.Should().Not.Be.Null();<br />    obj.Should().Not.Be.SameAs(new object());<br />    obj.Should().Not.Be.OfType&lt;string&gt;();<br />    obj.Should().Not.Equal("foo");<br /><br />    "This String".Should().Contain("This");<br />    "This String".Should().Not.Be.Empty();<br />    "This String".Should().Not.Contain("foobar");<br /><br />    var list = new List&lt;object&gt;();<br />    list.Should().Count.Zero();<br />    list.Should().Not.Contain.Item(new object());<br /><br />    var item = new object();<br />    list.Add(item);<br />    list.Should().Not.Be.Empty();<br />    list.Should().Contain.Item(item);<br /><br /></pre><br /><p>One really nice feature is that the framework isn’t tied to any testing framework but works nicely with any test framework.</p><br /><h3>Get me a substitute! Now!</h3><br /><p>The other framework is <a href="http://nsubstitute.github.com/" target="_blank">NSubstitute</a> which is a mocking framework. I first got hooked when I read their intro:</p><br /><blockquote><br /><p>Mock, stub, fake, spy, test double? Strict or loose? Nah, just substitute for the type you need!</p></blockquote><br /><p>I’m probably the only one (NOT!) who mess mock, stubs and fakes up except from just after I read a book on the subject. And really – who cares? I just want something to replace the real stuff for a while – let’s call it a substitute.</p><br /><p>The syntax is also super-clean and easy going. Here’s the example from the NSubstitute site:</p><pre>//Create:<br />var calculator = Substitute.For&lt;ICalculator&gt;();<br /> <br />//Set a return value:<br />calculator.Add(1, 2).Returns(3);<br />Assert.AreEqual(3, calculator.Add(1, 2));<br /> <br />//Check received calls:<br />calculator.Received().Add(1, Arg.Any&lt;int&gt;());<br />calculator.DidNotReceive().Add(2, 2);<br /><br /></pre><br /><h3>Come together. Right now!</h3><br /><p>But the true power, I think, you get when combining these two together. Here’s an example from I did to show <a href="http://www.specflow.org" target="_blank">SpecFlow</a> that uses both Should and NSubsitute:</p><pre>[Given(@"the following features in the database:")]<br />public void GivenTheFollowingFeaturesInTheDatabase(Table table)<br />{<br />   var features = table.CreateSet&lt;Feature&gt;().ToList();<br />   <br />   var dbWrapperSubsitute = Substitute.For&lt;IFeatureDBWrapper&gt;();<br />   dbWrapperSubsitute.AllNotDone().Returns(features);<br /><br />   ScenarioContext.Current.Set(dbWrapperSubsitute, DBWRAPPER_KEY);<br />}<br /><br />[When(@"I navigate to the homepage")]<br />public void WhenINavigateToTheHomepage()<br />{<br />    var featureDBWrapper = ScenarioContext.Current.Get&lt;IFeatureDBWrapper&gt;(DBWRAPPER_KEY);<br />    var controller = new HomeController(featureDBWrapper);<br /><br />    var indexView = controller.Index() as ViewResult;<br /><br />    indexView.Should().Not.Be.Null();<br />    indexView.ViewData.Model.Should().Not.Be.Null();<br />    var features = (IList&lt;Feature&gt;)indexView.ViewData.Model;<br />    features.Should().Not.Be.Null();<br /><br />    featureDBWrapper.Received().AllNotDone();<br /><br />    ScenarioContext.Current.Set(features, FEATURES_IN_VIEW_KEY);<br />}<br /><br />[Then(@"I should see a view with the following features:")]<br />public void ThenIShouldSeeAViewWithTheFollowingFeatures(Table table)<br />{<br />    var features = ScenarioContext.Current.Get&lt;IList&lt;Feature&gt;&gt;(FEATURES_IN_VIEW_KEY);<br /><br />    var expectedFeatures = table.CreateSet&lt;Feature&gt;();<br /><br />    foreach (var expectedFeature in expectedFeatures)<br />    {<br />        features.Should().Contain.Any( f =&gt; f.Name ==  expectedFeature.Name);<br />        features.Should().Contain.Any( f =&gt; f.AssignedTo ==  expectedFeature.AssignedTo);<br />        features.Should().Contain.Any( f =&gt; f.HoursWorked ==  expectedFeature.HoursWorked);<br />        features.Should().Contain.Any( f =&gt; f.Status ==  expectedFeature.Status);<br />        features.Should().Contain.Any( f =&gt; f.Size ==  expectedFeature.Size);<br />    }<br />}<br /><br /></pre><br /><p>You can find the whole <a href="https://github.com/marcushammarberg/Marcusoft.OutsideIn.FeatureDemo" target="_blank">solution here</a>.</p>  