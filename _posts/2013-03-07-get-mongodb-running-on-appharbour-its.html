---
layout: post
title: Get MongoDB running on AppHarbour - it's an AppSetting thing
date: '2013-03-07T09:32:00.001+01:00'
author: Marcus Hammarberg
tags:
- Nancy
- Tools
- .NET
- ContinuousDelivery
modified_time: '2013-03-07T09:32:05.227+01:00'
blogger_id: tag:blogger.com,1999:blog-36533086.post-2488664060079678455
blogger_orig_url: http://www.marcusoft.net/2013/03/get-mongodb-running-on-appharbour-its.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br />I have been playing around a bit with <a href="http://www.mongodb.org/">MongoDB</a> for the first time of my life. It's really a very nice experience and have a lot of the "just works"-feeling that I have started to get used to from frameworks like <a href="http://www.nancyfx.org/">NancyFx</a> and Simple.Data.<br /><br />But when i pushed it to AppHarbor I ran into problems. That all had with me not reading stuff properly…<br /><br /><a name='more'></a><br /><br />AppHarbor has a nice feature that replaces stuff in your .config files on deploy. That could be used for setting Production-environment values to your environment configuration. For example changing the connection string for a database.<br /><br />The add-on for Mongo DB at AppHarbor has a nice article describing this in detail. But I read it quickly and put the connection string in the <connectionstrings>-node of the web.config.&nbsp;</connectionstrings><br /><br />It should be added as an <appsetting>. As the documentation clearly points out. So you want this:</appsetting><br /><blockquote class="tr_bq">&nbsp; <span style="font-size: x-small;"><span style="font-family: Courier New, Courier, monospace;"><appsettings><br />&nbsp; &nbsp; <add font="" nbsp=""><span style="font-family: 'Courier New', Courier, monospace;">key="MONGOHQ_URL" value="mongodb://localhost/DotVoter"/&gt;</span>&nbsp;</add></appsettings></span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"></span></span></blockquote></div>That MONGOHQ_URL is a special name that the MongoDB add-on looks for at deploy time. It's replaced with your configuration variable (see AppHarbor-&gt;[Your application]-&gt;Configuration Variables) that is created for you when you add the MongoDB add on. <br /><br />You can then read that value as simple as this:<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">private readonly MongoCollection<t> _collection;</t></span></blockquote>&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-family: Courier New, Courier, monospace; font-size: x-small;">public MongoRepository()</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var connectionString =&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ConfigurationManager.AppSettings.Get("MONGOHQ_URL");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><br /></span><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var client = new MongoClient(connectionString);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var server = client.GetServer();</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><br /></span><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var con = new MongoUrlBuilder(connectionString);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var db = server.GetDatabase(con.DatabaseName);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _collection = db.GetCollection<t>(typeof(T).Name.ToLower());</t></span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><br />With that in place … it just works!<br />