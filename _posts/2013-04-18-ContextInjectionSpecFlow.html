---
layout: post
title: Context injection of driver object in SpecFlow
date: '2013-04-18T08:00:00.000+02:00'
author: Marcus Hammarberg
tags:
- BDD
- Tools
- .NET
- SpecificationByExample
- C#
- SpecFlow
modified_time: '2013-04-18T08:00:02.781+02:00'
blogger_id: tag:blogger.com,1999:blog-36533086.post-722525302763224865
blogger_orig_url: http://www.marcusoft.net/2013/04/ContextInjectionSpecFlow.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="http://specflow.org/">SpecFlow</a> is a wonderful tool. With a lot of hidden gems inside of it. I have been using and coding on it now for about 4 years and still I often forget about features and extension points that <a href="http://gasparnagy.com/">Gaspar</a> and the community has put in there.<br /><br />For example: did you know that there's an <a href="http://martinfowler.com/articles/injection.html">inversion of control</a> framework built right into SpecFlow? Now you do and in this post I wanted to show you one way that you could use that feature to make your step definitions more maintainable.<br /><br />I found this feature (again, i had heard about it before) when Gaspar mentioned it too me after my presentation at <a href="http://skillsmatter.com/podcast/agile-testing/cuke-envy-a-dot-net-programmers-attempt-to-catch-up">CukeUp 2013</a>&nbsp;and the usage is part of <a href="http://www.marcusoft.net/2013/04/PushTheHowDown.html">"Pushing the HOW down"</a> which I wrote at length on before.<br /><br /><a name='more'></a>The<a href="https://github.com/techtalk/SpecFlow/wiki/Context-Injection"> Context injection feature</a> (as it's called in SpecFlow) is one of those "just works"-feature and you don't have to think to much about how. Here's a simple example:<br /><br /><script src="https://gist.github.com/marcusoftnet/5394583.js"></script> <br /><div>The context injection feature simply creates the Driver object for us, as long as it has a parameterless constructor... or can figure out how to create the rest of the objects for us.<br /><br />That statement probably needs an explaination. Normally you would configure the IoC (inversion of control) container to know how and what to resolve as you ask it for objects. So you might say that "the next time someone asks for an <span style="font-family: Courier New, Courier, monospace;">IRespository</span> you should create a <span style="font-family: Courier New, Courier, monospace;">FakeRepository</span>".<br /><br />The context injection doesn't work like that. It's purely convention and a very simple one too: it creates objects that have parameter-less constructors (not&nbsp;entirely&nbsp;true but let's forget that for awhile). &nbsp;But of course it supports resolving in several steps. For example is the following scenario supported:<br /><br />Here you can see that the WithdrawSteps (in the WithdrawSteps.cs file at the bottom) has a dependency of the Driver_HTML class. That in turn has dependencies of the ATMPageWrapper and the AccountBuilder classes. All of this is nicely resolved by the context injection feature.<br /><br />You could of course resolve other stuff with this approach as well; reference data, test data class etc. but I think it really shines when it comes to stich your testing infrastructure together.<br /><h3 style="text-align: left;">Going advanced&nbsp;</h3></div><div>I told you above about the default, resolve-parameter-less-constructor-objects features of the context injection inversion of control container. There's an advanced version to this as well... Advanced, by the way, it contains 2 methods for&nbsp;registering types&nbsp;(<span style="font-family: Courier New, Courier, monospace;">RegisterInstanceAs(new Foo(), typeof (IFoo))</span> and <span style="font-family: Courier New, Courier, monospace;">RegisterTypeAs<ifoo fooimplementation="">()</ifoo></span>) and a single method for resolving.<br /><br />To use it you could write a <a href="http://www.marcusoft.net/2010/12/using-tags-in-specflow-features.html">BeforeScenario</a>-hook (there's also BeforeFeature and BeforeTestRun at your disposal)&nbsp;and configure the container. Like this:</div><div><script src="https://gist.github.com/marcusoftnet/5395081.js"></script></div><div><br /></div><div>(Note the [Binding]-attribute on the class of hooks, I forget that one every time...)<br /><br />This is great if you need to resolve objects that don't have parameterless constructors and you can also utilize this approach if you have objects that you just want one of. One example that springs to mind is a WebDriver object. This is often expensive and resource intensive to create and you often just need one active per scenario.&nbsp;</div><div><h3 style="text-align: left;">Wrap up</h3></div><div>The Context Injection feature of SpecFlow is not very well known and using it is rare in the implementations I've seen. That's a pity since it can clean up your testing infrastructure quite a bit. And you should. Testing code is also code - it deserves your love too.&nbsp;</div></div>