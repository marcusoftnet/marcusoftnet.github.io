--- 
	layout: post 
	title: SpecFlow.exe and MsTest 
	date: '2010-12-15T15:00:00.000+01:00' 
	author: Marcus Hammarberg 
	tags: 
		- BDD 
		- Tools 
		- Life of a consultant 
		- SpecFlow 
	modified_time: '2012-10-21T20:59:17.033+02:00' 
	thumbnail: http://4.bp.blogspot.com/_TI0jeIedRFk/TQjJvwiN9SI/AAAAAAAAAqI/jLAWtMkRrW0/s72-c/examplereport.png blogger_id: 
	tag:blogger.com,1999:blog-36533086.post-94606423148695401 
	blogger_orig_url: http://www.marcusoft.net/2010/12/specflowexe-and-mstest.html 
---

<div dir="ltr" style="text-align: left;" trbidi="on">With your <a href="http://www.specflow.org/" target="_blank">SpecFlow</a> installation comes SpecFlow.exe that is a program that can be used to generate tests from the scenarios AND to create nicely formatted reports from the generated test results.
    <br />There's been a lot written on how to generate these reports when your using NUnit (see <a href="http://www.codeproject.com/KB/architecture/BddWithSpecFlow.aspx">this </a>and <a href="http://si-w.co.uk/blog/2010/07/20/running-specflow-reports-from-within-visual-studio/">this </a>for example), but when it comes to managing this for MsTest there's been almost silent. And facing this problem I can sure see why... It's a bit trickier.
    <br />
    <br />In this blog post I want to show you two things; how to generate MsTest's from your .feature-files and how to create a report from the generated results. Finally I'll show you how to put the two together and link it up to a nice "External tool"-button in Visual Studio. Here we go:
    <br />
    <br />
    <h3>Generate MsTest's from your .feature-file</h3>With this step you can generate the test from you scenarios. SpecFlow.exe picks up your <a href="http://www.marcusoft.net/2010/12/appconfig-for-mstest-and-specflow.html" target="_blank">configuration</a> and generates the test in your test framework of choice.
    <br />From the look of it, it seems quite straight forward. Using the “help command” of SpecFlow.exe, “specflow help generateall” produces this help:
    <br />
    <blockquote><span style="font-family: 'Courier New';">Generate tests from all feature files in a project<br />usage: specflow generateall projectFile [/force] [/verbose]<br />&nbsp;&nbsp;&nbsp; projectFile&nbsp; Visual Studio Project File containing features</span></blockquote>OK. I put together a .bat file that does that. (Note that I’m on a 64-bit machine and had to use some funky DOS-shortcut to get there. No simple way to be <a href="http://marsbox.com/blog/howtos/batch-file-programfiles-x86-parenthesis-anomaly/" target="_blank">architecture agnostic</a> I’m afraid).
    <br />Here is my file:
    <br /><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">"%ProgramFiles(x86)%\TechTalk\SpecFlow\SpecFlow.exe" <br />generateAll Specs\Specs.csproj  <br />/force /verbose<br /><br />pause<br /></pre>
    <br />I’ve added some line breaks for readability.
    <br />
    <br />Well – that was easy.
    <br />
    <br />
    <h3>Create a report from the generated results</h3>
    <br />To get this step to work we have to run the test and get hold of the location of the test report file (.trx). When you do this from within Visual Studio the test reporting is done in a TestResult folder and the file get a name with a timestamp. That is not very script-friendly sadly and we’re forced into writing a bat-file that also run the tests.
    <br />
    <br />I used the <a href="http://msdn.microsoft.com/en-us/library/ms182489(v=VS.100).aspx" target="_blank">MsTest Command line reference</a> to put together this .bat-file:
    <br /><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">if Exist TestResult.trx del TestResult.trx </pre><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">"%ProgramFiles(x86)%\Microsoft Visual Studio 10.0\Common7\IDE\mstest.exe" </pre><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">/testcontainer:Specs\bin\Debug\Specs.dll </pre><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">/resultsfile:TestResult.trx </pre><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">pause<br /></pre>
    <br />
    <br />Again, watch out for me using a 64-bit Windows and use %programfiles% if you’re not.
    <br />
    <br />Some strangeness with MsTest made me delete the testResults.trx before each run. Also MsTest create some folders (username_testrun...) but that doesn’t bother me now.
    <br />
    <br />When we now have a created .trx file we can run the command that creates the report for us. According to the “documentation” (specflow help mstestexecutionreport"):
    <br />
    <br />
    <blockquote><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">usage: specflow mstestexecutionreport projectFile <br />[/testResult:value] <br />[/xsltFile:value] <br />[/out:value]</pre></blockquote>
    <br />
    <ul>
        <li>The projectFile is the Visual Studio Project File containing features and specifications.
            <br />
        </li>
        <li>Test Result refers to the .trx file generated by MsTest And it defaults to TestResult.trx
            <br />
        </li>
        <li>Xslt file to use, defaults to built-in stylesheet if not provided
            <br />
        </li>
        <li>out is the generated output file. Defaults to TestResult.html </li>
    </ul>
    <blockquote></blockquote>I’m happy with the defaults of the last three since I <a href="http://www.youtube.com/watch?v=Ubw5N8iVDHI&amp;feature=related" target="_blank">choose my .trx-file name ... wisely</a>. :)
    <br />So my whole .bat-file becomes this:
    <br /><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">"%ProgramFiles(x86)%\TechTalk\SpecFlow\SpecFlow.exe" mstestexecutionreport Specs\Specs.csproj <br /><br />pause<br /></pre>A low and behold; it actually produces the nice report we wanted:
    <br />
    <div class="separator" style="clear: both; text-align: center;">
        <a href="http://4.bp.blogspot.com/_TI0jeIedRFk/TQjJvwiN9SI/AAAAAAAAAqI/jLAWtMkRrW0/s1600/examplereport.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="158" src="http://4.bp.blogspot.com/_TI0jeIedRFk/TQjJvwiN9SI/AAAAAAAAAqI/jLAWtMkRrW0/s320/examplereport.png" width="320" /></a>
    </div>
    <br />
    <h3>Putting it all together</h3>That’s neat – we now have three different .bat files that we need to click in consecutive order ;)
    <br />No really – the first one (generate test from features can most certainly be handled by Visual Studio in most cases. Or in any case will probably not run in conjunction with the other two steps.
    <br />But to run the tests and produce a report would be nice with a single file. Here it is:
    <br /><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">if Exist TestResult.trx del TestResult.trx <br /><br />"%ProgramFiles(x86)%\Microsoft Visual Studio 10.0\Common7\IDE\mstest.exe" /testcontainer:Specs\bin\Debug\Specs.dll /resultsfile:TestResult.trx <br /><br />"%ProgramFiles(x86)%\TechTalk\SpecFlow\SpecFlow.exe" mstestexecutionreport Specs\Specs.csproj /testResult:TestResult.trx<br /><br />pause<br /></pre>And looking to this <a href="http://si-w.co.uk/blog/2010/07/20/running-specflow-reports-from-within-visual-studio/" target="_blank">blog post</a> I’ve also created a parameterized version of it that I can hook up to a “external command” that does that with a single click. That changes the bat-file into this:
    <br /><pre class="brush: xml; ruler: true; gutter: false; toolbar: false; collapse: true; auto-links: false;">if Exist TestResult.trx del TestResult.trx <br /><br />"%ProgramFiles(x86)%\Microsoft Visual Studio 10.0\Common7\IDE\mstest.exe" /testcontainer:%2 /resultsfile:TestResult.trx <br /><br />"%ProgramFiles(x86)%\TechTalk\SpecFlow\SpecFlow.exe" mstestexecutionreport %1 /testResult:TestResult.trx /out:TestResult.html<br /><br />echo Created file TestResult.html<br /></pre>So you need to send the name of the test container (the .dll) and the project file. Save that file to a known location so that you can point your external command to it.
    <br />Finally you can create a external tool button in Visual Studio and set the parameters as follows:
    <br />
    <div class="separator" style="clear: both; text-align: center;">
        <a href="http://2.bp.blogspot.com/_TI0jeIedRFk/TQjJ4c73ElI/AAAAAAAAAqM/pIZm5ZEHHEU/s1600/configuring+external+tools.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="311" src="http://2.bp.blogspot.com/_TI0jeIedRFk/TQjJ4c73ElI/AAAAAAAAAqM/pIZm5ZEHHEU/s320/configuring+external+tools.png" width="320" /></a>
    </div>
    <br />The arguments to the external command are:
    <br />
    <ul>
        <li>$(ProjectDir)$(ProjectFileName)
            <br />
        </li>
        <li>$(TargetName)$(TargetExt)</li>
    </ul>Note that the project with specifications has to be selected before the External command can be run.
    <br />
    <h3>Conclusion</h3>In this blog post I’ve learned how hook up SpecFlow to generate tests and reports for me.
    <br />You can <a href="https://github.com/marcusoftnet/Demo-Reporting-with-MsTest" target="_blank">download my code here</a></div>
